/**
 * ุฎุฏูุฉ ุงูุชุญููู ุงูุฐูู ูููุฐูุฑุงุช ุงููุงููููุฉ
 * Memo Analysis Service - Specialized Legal AI for Saudi Law
 * 
 * ูุธุงู ุชุญููู ุฐูู ูุชุฎุตุต ููู ููุน ูุฐูุฑุฉ ููู ุงููุงููู ุงูุณุนูุฏู
 */

import { callLegalAI, hasGeminiApiKey } from './legalAIService';

// ุฃููุงุน ูุญุฑูุงุช ุงูุชุญููู
export type AnalysisEngineType =
    | 'gatekeeper'      // ุงูุญุงุฑุณ - ุงููุชุทูุจุงุช ุงูุดูููุฉ ูุงููุธุงููุฉ
    | 'brain'           // ุงูุนูู - ุงูุชุญููู ุงูููุถูุนู ูุงูุงุณุชุฑุงุชูุฌู
    | 'opponent'        // ุงูุฎุตู - ูุญุงูุงุฉ ุฑุฏ ุงูุฎุตู
    | 'polish'          // ุงูุตูู - ุชุญุณูู ุงูุตูุงุบุฉ ุงููุงููููุฉ
    | 'compliance';     // ุงูุงูุชุซุงู - ูุญุต ุงูุฃูุธูุฉ ุงูุณุนูุฏูุฉ

// ูุงุฌูุฉ ูุชูุฌุฉ ุงูุชุญููู
export interface MemoAnalysisResult {
    engine: AnalysisEngineType;
    engineName: string;
    icon: string;
    result: string;
    success: boolean;
    processingTime?: number;
}

// ูุงุฌูุฉ ุงูุชุญููู ุงููุงูู
export interface FullMemoAnalysis {
    memoType: string;
    memoTypeName: string;
    analyses: MemoAnalysisResult[];
    overallScore?: number;
    timestamp: Date;
}

// ูุนูููุงุช ูุญุฑูุงุช ุงูุชุญููู
export const ANALYSIS_ENGINES: Record<AnalysisEngineType, { name: string; icon: string; description: string }> = {
    gatekeeper: {
        name: 'ุงูุญุงุฑุณ ุงูุดููู',
        icon: '๐ก๏ธ',
        description: 'ูุญุต ุงููุชุทูุจุงุช ุงูุดูููุฉ ูุงููุธุงููุฉ'
    },
    brain: {
        name: 'ุงููุญูู ุงูุงุณุชุฑุงุชูุฌู',
        icon: '๐ง',
        description: 'ุงูุชุญููู ุงูููุถูุนู ูุจูุงุก ุงูุงุณุชุฑุงุชูุฌูุฉ'
    },
    opponent: {
        name: 'ูุญุงูู ุงูุฎุตู',
        icon: 'โ๏ธ',
        description: 'ุชููุน ุฑุฏ ุงูุฎุตู ููุดู ููุงุท ุงูุถุนู'
    },
    polish: {
        name: 'ุงููุฏูู ุงููุงูููู',
        icon: 'โจ',
        description: 'ุชุญุณูู ุงูุตูุงุบุฉ ูุงูุชุฏููู ุงููุบูู'
    },
    compliance: {
        name: 'ูุฑุงุฌุน ุงูุงูุชุซุงู',
        icon: '๐',
        description: 'ูุญุต ุงูุชูุงูู ูุน ุงูุฃูุธูุฉ ุงูุณุนูุฏูุฉ'
    }
};

// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
// ๐ฏ ุงูุจุฑููุจุชุงุช ุงููุชุฎุตุตุฉ ููู ููุน ูุฐูุฑุฉ
// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

// ุงูุจุฑููุจุช ุงูุฃุณุงุณู ููุญุงุฑุณ ุงูุดููู (ูุดุชุฑู ูุฌููุน ุงููุฐูุฑุงุช)
const BASE_GATEKEEPER_PROMPT = `ุฃูุช ูุณุชุดุงุฑ ูุงูููู ุณุนูุฏู ุฎุจูุฑ ูุชุฎุตุต ูู ุงูุฅุฌุฑุงุกุงุช ุงูุดูููุฉ ูุงููุธุงููุฉ ุฃูุงู ุงููุญุงูู ุงูุณุนูุฏูุฉ.

ุงููููุฉ: ูุญุต ุงููุฐูุฑุฉ ุงููุงููููุฉ ุงูุชุงููุฉ ููุชุฃูุฏ ูู ุงุณุชููุงุก ุงููุชุทูุจุงุช ุงูุดูููุฉ ูุงููุธุงููุฉ.

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ ูุงุฆูุฉ ุงููุญุต ุงูุดููู:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ใุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉใ
โ/โ ุงุณู ุงููุญููุฉ ุงููุฎุชุตุฉ
โ/โ ุฑูู ุงููุถูุฉ (ุฅู ูุฌุฏ)
โ/โ ุฃุณูุงุก ุงูุฃุทุฑุงู ูุงููุฉ
โ/โ ุตูุงุช ุงูุฃุทุฑุงู (ูุฏุนู/ูุฏุนู ุนููู/ูุณุชุฃูู)
โ/โ ุฃุฑูุงู ุงููููุฉ ุงููุทููุฉ ุฃู ุงูุณุฌู ุงูุชุฌุงุฑู
โ/โ ุนูุงููู ุงูุฃุทุฑุงู

ใุงูุงุฎุชุตุงุตใ
- ุงูุงุฎุชุตุงุต ุงูููุนู: ูู ุงููุญููุฉ ุงููุฎุชุงุฑุฉ ูุฎุชุตุฉุ
- ุงูุงุฎุชุตุงุต ุงูููุงูู: ูู ุงููููุน ุงูุฌุบุฑุงูู ุตุญูุญุ
- ุงูุฅุญุงูุฉ: ุฅุฐุง ูุงู ููุงู ุชุญููู ุจูู ุงููุญุงูู

ใุงูููุงุนูุฏ ุงููุธุงููุฉใ
โ๏ธ ุชูุจูู ุจุงูููุงุนูุฏ ุงูุญุฑุฌุฉ:
{DEADLINE_SPECIFIC}

ใุงูุทูุจุงุชใ
- ูู ุงูุทูุจุงุช ูุญุฏุฏุฉ ููุงุถุญุฉุ
- ูู ููุงู ุชุณูุณู ููุทููุ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ ุงูุชูุฑูุฑ:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ใุงูููุฎุต ุงูุชูููุฐูใ
๐ข ูุณุชูููุฉ ุดูููุงู / ๐ก ุชุญุชุงุฌ ุชุนุฏููุงุช / ๐ด ูุงูุตุฉ ุฌููุฑูุงู

ใุงูุจูุงูุงุช ุงููุงูุตุฉใ
ูุงุฆูุฉ ุจุงูุนูุงุตุฑ ุงูููููุฏุฉ ูุน ุงูุชุตุญูุญ ุงูููุชุฑุญ

ใุงูุชูุตูุงุช ุงูุนุงุฌูุฉใ
ุฃููููุงุช ูุฌุจ ูุนุงูุฌุชูุง ููุฑุงู

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ุงููุฐูุฑุฉ ุงููุฑุงุฏ ูุญุตูุง:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
{TEXT}`;

// ุงูุจุฑููุจุช ุงูุฃุณุงุณู ููุชุญููู ุงูููุถูุนู (Brain)
const BASE_BRAIN_PROMPT = `ุฃูุช ูุญุงูู ุณุนูุฏู ุฎุจูุฑ ููุณุชุดุงุฑ ูุงูููู ูุชุฎุตุต ูู ุจูุงุก ุงูุงุณุชุฑุงุชูุฌูุงุช ุงููุงููููุฉ ูุชุญููู ุงููุถุงูุง.

ุงููููุฉ: ุชุญููู ุงููุฐูุฑุฉ ููุถูุนูุงู ูุงุณุชุฑุงุชูุฌูุงู.

{MEMO_TYPE_SPECIFIC}

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ุงููุฐูุฑุฉ ุงููุฑุงุฏ ุชุญููููุง:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
{TEXT}`;

// ุงูุจุฑููุจุช ุงูุฃุณุงุณู ููุญุงูุงุฉ ุงูุฎุตู
const BASE_OPPONENT_PROMPT = `ุฃูุช ูุญุงูู ุณุนูุฏู ูุชูุฑุณุ ูููุชู ุงูุขู ุฃู ุชุชููุต ุฏูุฑ ูุญุงูู ุงูุทุฑู ุงูุขุฎุฑ (ุงูุฎุตู) ูุชุญูู ุงููุฐูุฑุฉ ูู ูุฌูุฉ ูุธุฑู.

ุงููููุฉ: ุงูุชุดุงู ููุงุท ุงูุถุนู ูุงูุชุฑุงุญ ุงูุฑุฏูุฏ ุงููุญุชููุฉ ูู ุงูุฎุตู.

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ ูููุฌูุฉ ุงูุชุญููู:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ใููุงุท ุงูุถุนู ุงูููุชุดูุฉใ
ุงุจุญุซ ุนู:
- ุงุฏุนุงุกุงุช ุจุฏูู ุณูุฏ
- ุซุบุฑุงุช ูู ุงูุณุฑุฏ
- ุชูุงูุถุงุช ุฏุงุฎููุฉ
- ุฃุฏูุฉ ุถุนููุฉ

ใุงูุฑุฏูุฏ ุงููุชููุนุฉ ูู ุงูุฎุตูใ
ููู ููุทุฉ ุถุนู:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ๏ธ ููุทุฉ ุงูุถุนู: [ูุตููุง]
โ ๐ ูููุนูุง ูู ุงููุฐูุฑุฉ: [ุงูุชุจุงุณ]
โ โ๏ธ ุฑุฏ ุงูุฎุตู ุงููุชููุน: [ููู ุณูุณุชุบููุง]
โ ๐ก๏ธ ููู ุชุญุตูู ููููู: [ุงูุฅุฌุฑุงุก ุงูููุงุฆู]
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ใุงุณุชุฑุงุชูุฌูุฉ ุงูุฎุตู ุงููุชููุนุฉใ
ูุงุฐุง ุณููุนู ุงูุฎุตู ูู ุงูุฌูุณุฉ ุงููุงุฏูุฉุ

ใุชูุตูุงุช ุชุญุตูู ุงููุฐูุฑุฉใ
ูุงุฆูุฉ ุจุงูุชุนุฏููุงุช ูุชุญุตูู ุงููุฐูุฑุฉ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ุงููุฐูุฑุฉ ุงููุฑุงุฏ ุชุญููููุง:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
{TEXT}`;

// ุงูุจุฑููุจุช ุงูุฃุณุงุณู ููุตูู ุงููุบูู ูุงููุงูููู
const BASE_POLISH_PROMPT = `ุฃูุช ูุฏูู ูุงูููู ููุบูู ุณุนูุฏู ูุชุฎุตุต ูู ุงูุตูุงุบุฉ ุงููุงููููุฉ ุงูุฑุตููุฉ.

ุงููููุฉ: ูุฑุงุฌุนุฉ ูุชุญุณูู ุงูุตูุงุบุฉ ุงููุงููููุฉ ูููุฐูุฑุฉ.

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ ูุญุงูุฑ ุงูุชุฏููู:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ใุงูุชุญููู ูู ุงูุนุงููุฉ ูููุตุญู ุงููุงููููุฉใ
ุชุญููู ุฃู ุนุจุงุฑุงุช ุนุงููุฉ ุฅูู ูุบุฉ ูุงููููุฉ ุฑุตููุฉ:
| ุงูุนุจุงุฑุฉ ุงูุญุงููุฉ | ุงูุตูุงุบุฉ ุงููุงููููุฉ |
|----------------|-------------------|

ใุงูุชุฏููู ุงูุฅููุงุฆู ูุงููุญููใ
- ุงูุฃุฎุทุงุก ุงูุฅููุงุฆูุฉ
- ุงูุฃุฎุทุงุก ุงููุญููุฉ
- ุงููุตุทูุญุงุช ุงููุงููููุฉ ุบูุฑ ุงูุฏูููุฉ

ใุชุญุณูู ุงูุจููุฉใ
- ุชุณูุณู ุงูุฃููุงุฑ
- ูุถูุญ ุงูุทูุจุงุช
- ููุฉ ุงูุญุฌุฌ

ใุงูุตูุงุบุฉ ุงููุญุณููุฉใ
ุฃุนุฏ ุตูุงุบุฉ ุงูููุฑุงุช ุงูุถุนููุฉ ุจุดูู ุฃูุถู

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ุงููุฐูุฑุฉ ุงููุฑุงุฏ ุชุญุณูููุง:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
{TEXT}`;

// ุงูุจุฑููุจุช ุงูุฃุณุงุณู ููุญุต ุงูุงูุชุซุงู
const BASE_COMPLIANCE_PROMPT = `ุฃูุช ูุณุชุดุงุฑ ูุงูููู ุณุนูุฏู ูุชุฎุตุต ูู ุงูุฃูุธูุฉ ูุงูููุงุฆุญ ุงูุณุนูุฏูุฉ.

ุงููููุฉ: ูุญุต ุงููุฐูุฑุฉ ููุชุฃูุฏ ูู ุชูุงูููุง ูุน ุงูุฃูุธูุฉ ุงูุณุนูุฏูุฉ ุงููุนููู ุจูุง.

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ ุงูุฃูุธูุฉ ุงููุฑุงุฏ ูุญุต ุงูุชูุงูู ูุนูุง:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

{SYSTEMS_TO_CHECK}

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ ุชูุฑูุฑ ุงูุงูุชุซุงู:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ใุงูููุงุฏ ุงููุธุงููุฉ ุงููุทุจูุฉใ
ูุงุฆูุฉ ุจุงูููุงุฏ ุฐุงุช ุงูุตูุฉ ูู ุงูุฃูุธูุฉ ุงูุณุนูุฏูุฉ

ใูุณุชูู ุงูุงูุชุซุงูใ
๐ข ูุชูุงูู / ๐ก ุชุญูุธุงุช / ๐ด ูุฎุงูู

ใููุงุท ุงูุชูุงููใ
ูุง ูุชูู ูุน ุงููุธุงู

ใููุงุท ุงููุฎุงููุฉ ุฃู ุงูููุตใ
ูุง ูุญุชุงุฌ ุชุนุฏูู

ใุงูููุงุฏ ุงูููุชุฑุญ ุงูุงุณุชุดูุงุฏ ุจูุงใ
ููุงุฏ ูุธุงููุฉ ุชููู ุงููููู

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ุงููุฐูุฑุฉ ุงููุฑุงุฏ ูุญุตูุง:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
{TEXT}`;

// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
// ๐ฏ ุงูุจุฑููุจุชุงุช ุงููุฎุตุตุฉ ููู ููุน ูุฐูุฑุฉ
// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

const MEMO_SPECIFIC_PROMPTS: Record<string, {
    brain: string;
    deadlineSpecific: string;
    systemsToCheck: string;
}> = {
    // โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    // ๐ ุตุญููุฉ ุงูุฏุนูู
    // โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    claim_petition: {
        brain: `
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ ุชุญููู ุตุญููุฉ ุงูุฏุนูู:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ใุชุญุฑูุฑ ุงูุฏุนููใ
- ูู ุงูููุงุฆุน ูุณุฑูุฏุฉ ุจุดูู ูุงุถุญ ููุชุณูุณู ุฒูููุงูุ
- ูู ููุงู ุนูุงูุฉ ุณุจุจูุฉ ูุงุถุญุฉ ุจูู ุงูููุงุฆุน ูุงูุทูุจุงุชุ
- ูู ุงูุทูุจุงุช ูุญุฏุฏุฉ ููุงุจูุฉ ููุชูููุฐุ

ใุตูุฉ ุงููุฏุนูใ
- ูู ุตูุฉ ุงููุฏุนู ูุงุถุญุฉ ููุซุจุชุฉุ
- ูู ุงููุตูุญุฉ ูู ุงูุฏุนูู ูุงุฆูุฉ ููุจุงุดุฑุฉุ

ใุงูุฃุณุงููุฏ ุงููุงููููุฉใ
- ูุง ุงูููุงุฏ ุงููุธุงููุฉ ุงูุฏุงุนูุฉ ููุฏุนููุ
- ูู ุชู ุงูุงุณุชุดูุงุฏ ุจูุง ุจุดูู ุตุญูุญุ

ใููุฉ ุงูุฃุฏูุฉใ
ุชูููู ุงูุฃุฏูุฉ ุงููุฐููุฑุฉ:
| ุงูุฏููู | ููุนู | ููุชู | ููุงุญุธุงุช |
|--------|------|------|---------|

ใุงูุทูุจุงุชใ
ุชุญููู ูู ุทูุจ:
- ุงูุทูุจ ุงูุฑุฆูุณู: [ุชูููู]
- ุงูุทูุจุงุช ุงููุฑุนูุฉ: [ุชูููู]
- ุงูุทูุจ ุงูุงุญุชูุงุทู: [ูู ููุฌูุฏุ]

ใุงูุชูุตูุงุชใ
ุงูุชุฑุงุญุงุช ูุชูููุฉ ุตุญููุฉ ุงูุฏุนูู`,
        deadlineSpecific: `
- ูุฏุฉ ุงูุชูุงุฏู ุญุณุจ ููุน ุงูุฏุนูู
- ููุงุนูุฏ ุชูุฏูู ุงููุณุชูุฏุงุช`,
        systemsToCheck: `
- ูุธุงู ุงููุฑุงูุนุงุช ุงูุดุฑุนูุฉ
- ูุธุงู ุงููุนุงููุงุช ุงููุฏููุฉ (ุงูุฌุฏูุฏ)
- ุงูุฃูุธูุฉ ุงูุฎุงุตุฉ ุญุณุจ ููุถูุน ุงูุฏุนูู`
    },

    // โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    // ๐ ูุฐูุฑุฉ ุงูุฑุฏ ุนูู ุตุญููุฉ ุงูุฏุนูู
    // โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    response_to_claim: {
        brain: `
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ ุชุญููู ูุฐูุฑุฉ ุงูุฑุฏ (Gap Analysis):
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ใุชุญููู ุงูุซุบุฑุงุช - ูุง ูู ููุฑุฏ ุนูููใ
ูุญุต ูู ุงุฏุนุงุก ูู ุตุญููุฉ ุงูุฏุนูู ูุงูุชุฃูุฏ ูู ูุฌูุฏ ุฑุฏ:
| ุงุฏุนุงุก ุงููุฏุนู | ูู ุชู ุงูุฑุฏ ุนูููุ | ููุฉ ุงูุฑุฏ | ููุงุญุธุงุช |
|--------------|------------------|----------|---------|

ใุงูุฏููุน ุงูุดูููุฉใ
- ูู ุชู ุฅุซุงุฑุฉ ุฏููุน ุดูููุฉ ููุงุณุจุฉุ
- ุนุฏู ุงูุงุฎุชุตุงุต
- ุงูุนุฏุงู ุงูุตูุฉ
- ุณุจู ุงููุตู
- ุงูุชูุงุฏู

ใุงูุฏููุน ุงูููุถูุนูุฉใ
- ูู ุชู ุฏุญุถ ูู ุงุฏุนุงุกุ
- ูู ุงูุฃุฏูุฉ ุงููุถุงุฏุฉ ูุงููุฉุ

ใุงูุทูุจุงุช ุงูุนุงุฑุถุฉใ
- ูู ููุงู ูุฑุตุฉ ูุฏุนูู ููุงุจูุฉุ
- ูู ููุงู ุทูุจุงุช ุนุงุฑุถุฉ ููุงุณุจุฉุ

ใุงูุฃุณุงููุฏ ุงููุธุงููุฉใ
- ุงูููุงุฏ ุงููุณุชุฎุฏูุฉ ูู ุงูุฑุฏ
- ููุงุฏ ุฅุถุงููุฉ ููุชุฑุญุฉ

ใุชูุตูุงุช ุงูุชุญุตููใ
ูุง ูุฌุจ ุฅุถุงูุชู ูุชูููุฉ ูุฐูุฑุฉ ุงูุฑุฏ`,
        deadlineSpecific: `
- ููุนุฏ ุชูุฏูู ูุฐูุฑุฉ ุงูุฑุฏ (ุนุงุฏุฉ 10 ุฃูุงู)
- ููุนุฏ ุงูุฌูุณุฉ ุงููุงุฏูุฉ`,
        systemsToCheck: `
- ูุธุงู ุงููุฑุงูุนุงุช ุงูุดุฑุนูุฉ (ุฎุงุตุฉ ููุงุฏ ุงูุฑุฏ ูุงูุฏููุน)
- ูุธุงู ุงููุนุงููุงุช ุงููุฏููุฉ
- ุงูุฃูุธูุฉ ุงูุฎุงุตุฉ ุจููุถูุน ุงูุฏุนูู`
    },

    // โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    // โ๏ธ ูุฐูุฑุฉ ุงูุงุณุชุฆูุงู
    // โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    appeal_memo: {
        brain: `
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ ุชุญููู ูุฐูุฑุฉ ุงูุงุณุชุฆูุงู (ุงููุงุฆุญุฉ ุงูุงุนุชุฑุงุถูุฉ):
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ใุชุญููู ุฃุณุจุงุจ ุงูุญููใ
ูุญุต ูู ุณุจุจ ูู ุฃุณุจุงุจ ุงูุญูู ุงููุณุชุฃูู:
| ุณุจุจ ุงูุญูู | ุงูุฎุทุฃ ุงููุฏุนู | ุงูุณูุฏ ุงููุธุงูู | ููุฉ ุงูุงุนุชุฑุงุถ |
|-----------|--------------|---------------|--------------|

ใุฃุฎุทุงุก ุชุทุจูู ุงููุธุงูใ
- ูู ุทูุจู ุงููุธุงู ุจุดูู ุฎุงุทุฆุ
- ูู ุชู ุชุฌุงูู ูุต ูุธุงูู ูุงุฌุจ ุงูุชุทุจููุ

ใุงููุตูุฑ ูู ุงูุชุณุจูุจใ
- ูู ุฃุบูู ุงูุญูู ุงูุฑุฏ ุนูู ุฏููุน ุฌููุฑูุฉุ
- ูู ููุงู ุชูุงูุถ ูู ุฃุณุจุงุจ ุงูุญููุ

ใุงูุฅุฎูุงู ุจุญู ุงูุฏูุงุนใ
- ูู ุชู ุงุญุชุฑุงู ุงูุถูุงูุงุช ุงูุฅุฌุฑุงุฆูุฉุ
- ูู ุฃูุชูุญุช ุงููุฑุตุฉ ุงููุงููุฉ ููุฏูุงุนุ

ใูุฎุงููุฉ ุงูุซุงุจุช ุจุงูุฃูุฑุงูใ
- ูู ุชุฌุงูู ุงูุญูู ุฃุฏูุฉ ููุฏูุฉุ
- ูู ุจููู ุนูู ููุงุฆุน ุบูุฑ ุตุญูุญุฉุ

ใุชูุตูุงุช ุชูููุฉ ุงูุงุณุชุฆูุงูใ
- ุฃุณุจุงุจ ุฅุถุงููุฉ ููุชุฑุญุฉ
- ุฃุฏูุฉ ุฌุฏูุฏุฉ ูููู ุชูุฏูููุง`,
        deadlineSpecific: `
โ๏ธ ููู ุฌุฏุงู - ููุงุนูุฏ ุงูุงุณุชุฆูุงู:
- 30 ูููุงู ูู ุชุงุฑูุฎ ุงุณุชูุงู ุตู ุงูุญูู (ููุฃุญูุงู ุงูุนุงุฏูุฉ)
- 15 ูููุงู ููุฃุญูุงู ุงููุณุชุนุฌูุฉ
- ุชุญูู ูู ุชุงุฑูุฎ ุงูุงุณุชูุงู!`,
        systemsToCheck: `
- ูุธุงู ุงููุฑุงูุนุงุช ุงูุดุฑุนูุฉ (ุงูุจุงุจ ุงูุซุงูู - ุงูุงุณุชุฆูุงู)
- ูุธุงู ุงููุญุงูู ุงูุชุฌุงุฑูุฉ ุฅุฐุง ูุงูุช ุชุฌุงุฑูุฉ
- ุงููุจุงุฏุฆ ุงููุถุงุฆูุฉ ูููุญููุฉ ุงูุนููุง`
    },

    // โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    // โก ูุฐูุฑุฉ ุทูุจ ุงูุชูููุฐ
    // โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    execution_request: {
        brain: `
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ ุชุญููู ูุฐูุฑุฉ ุทูุจ ุงูุชูููุฐ:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ใุตุญุฉ ุงูุณูุฏ ุงูุชูููุฐูใ
- ูู ุงูุณูุฏ ููุงุฆู ููุทุนูุ
- ูู ุงูุตูุบุฉ ุงูุชูููุฐูุฉ ุตุญูุญุฉุ
- ูู ูุถุช ูุฏุฉ ุงูุงุณุชุฆูุงูุ

ใุชุญุฏูุฏ ุงููููุฐ ุถุฏูใ
- ูู ุจูุงูุงุช ุงููููุฐ ุถุฏู ูุงููุฉุ
- ูู ุงูุนููุงู ุตุญูุญ ููุชุจููุบุ

ใุชุญุฏูุฏ ุงููุงู ุงููุทููุจ ุชูููุฐูใ
- ูู ุงููุจูุบ ูุญุฏุฏ ุจุฏูุฉุ
- ูู ููุงู ููุงุฆุฏ ุฃู ุชุนููุถุงุช ุฅุถุงููุฉุ

ใุฅุฌุฑุงุกุงุช ุงูุญุฌุฒ ุงูููุชุฑุญุฉใ
ุจูุงุกู ุนูู ุทุจูุนุฉ ุงูุฏูู ูุงููุฏูู:
| ููุน ุงูุญุฌุฒ | ุงูุฅุฌุฑุงุก | ุงูุฃููููุฉ |
|-----------|---------|----------|
| ุญุณุงุจุงุช ุจูููุฉ | ... | 1 |
| ุนูุงุฑุงุช | ... | 2 |
| ูููููุงุช | ... | 3 |
| ุฑูุงุชุจ | ... | 4 |

ใุชูุตูุงุช ุงูุชูููุฐใ
ุงุณุชุฑุงุชูุฌูุฉ ุชูููุฐ ูุนุงูุฉ`,
        deadlineSpecific: `
- ูุฏุฉ ุตูุงุญูุฉ ุงูุณูุฏ ุงูุชูููุฐู
- ููุงุนูุฏ ุงูุฅุฎุทุงุฑ ูุงูุชุจููุบ`,
        systemsToCheck: `
- ูุธุงู ุงูุชูููุฐ ุงูุณุนูุฏู
- ูุงุฆุญุฉ ูุธุงู ุงูุชูููุฐ
- ุฃูุธูุฉ ุงูุญุฌุฒ ูุงูููุน ูู ุงูุณูุฑ`
    },

    // โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    // ๐๏ธ ูุฐูุฑุฉ ุงููุถุงูุง ุงูุชุฌุงุฑูุฉ
    // โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    commercial_memo: {
        brain: `
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ ุชุญููู ุงููุฐูุฑุฉ ุงูุชุฌุงุฑูุฉ:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ใุทุจูุนุฉ ุงููุฒุงุน ุงูุชุฌุงุฑูใ
- ููุน ุงูุนูุฏ ุงูุชุฌุงุฑู
- ุงูุฃุทุฑุงู ุงูุชุฌุงุฑูุฉ
- ูููุฉ ุงููุฒุงุน

ใุชุญููู ุงูุนูุงูุฉ ุงูุชุนุงูุฏูุฉใ
- ุดุฑูุท ุงูุนูุฏ ุงูุฌููุฑูุฉ
- ุงูุฅุฎูุงู ุงููุฏุนู ุจู
- ุงูุถุฑุฑ ูุงูุชุนููุถ

ใุงูุงุฎุชุตุงุต ุงูุชุฌุงุฑูใ
- ูู ุงูุฏุงุฆุฑุฉ ุงูุชุฌุงุฑูุฉ ูุฎุชุตุฉุ
- ูู ููุฌุฏ ุดุฑุท ุชุญูููุ

ใุงูุฃุฏูุฉ ุงูุชุฌุงุฑูุฉใ
ุชูููู ุงูุฃุฏูุฉ:
| ุงูุฏููู | ููุนู | ุญุฌูุชู | ููุงุญุธุงุช |
|--------|------|-------|---------|
| ุงูุนูุฏ | ูุชุงุจู | ููู | |
| ุงูููุงุชูุฑ | ุชุฌุงุฑู | ูุชูุณุท | |
| ุงููุฑุงุณูุงุช | ุฅููุชุฑููู | ูุญุชุงุฌ ุชูุซูู | |

ใุชูุตูุงุชใ
ููุงุท ุงูููุฉ ูุงูุถุนู`,
        deadlineSpecific: `
- ููุงุนูุฏ ุงููุญุงูู ุงูุชุฌุงุฑูุฉ (ุฃุณุฑุน)
- ูุฏุฏ ุงูุทุนู ูู ุงูุฃุญูุงู ุงูุชุฌุงุฑูุฉ`,
        systemsToCheck: `
- ูุธุงู ุงููุญุงูู ุงูุชุฌุงุฑูุฉ
- ูุธุงู ุงูุดุฑูุงุช
- ูุธุงู ุงูุฃูุฑุงู ุงูุชุฌุงุฑูุฉ
- ูุธุงู ุงูุชุญููู`
    },

    // โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    // ๐ท ูุฐูุฑุฉ ุงููุถุงูุง ุงูุนูุงููุฉ
    // โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    labor_memo: {
        brain: `
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ ุชุญููู ุงููุฐูุฑุฉ ุงูุนูุงููุฉ:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ใุทุจูุนุฉ ุงููุฒุงุน ุงูุนูุงููใ
- ููุน ุงูุนูุงูุฉ ุงูุนูุงููุฉ
- ุณุจุจ ุงููุฒุงุน (ูุตูุ ุฃุฌูุฑุ ุฅุตุงุจุฉ...)
- ุงููุทุงูุจุงุช

ใุญููู ุงูุนุงูู ุงููุทุงูุจ ุจูุงใ
ุชูููู ูู ูุทุงูุจุฉ:
| ุงููุทุงูุจุฉ | ุงูุณูุฏ ุงููุธุงูู | ูุฏู ุงูุฃุญููุฉ | ุงูููุงุญุธุงุช |
|----------|---------------|-------------|-----------|
| ููุงูุฃุฉ ููุงูุฉ ุงูุฎุฏูุฉ | ู.84-88 | | |
| ุจุฏู ุงูุฅุฌุงุฒุงุช | ู.109 | | |
| ุฃุถุฑุงุฑ ุงููุตู ุงูุชุนุณูู | ู.77 | | |

ใุงูุชุณููุฉ ุงููุฏูุฉใ
- ูู ุชูุช ุฅุฌุฑุงุกุงุช ุงูุชุณููุฉ ุงููุฏูุฉุ
- ูุฑุงุฑุงุช ููุชุจ ุงูุนูู

ใุงูุฃุฏูุฉ ุงูุนูุงููุฉใ
- ุนูุฏ ุงูุนูู
- ูุดูู ุงูุฑูุงุชุจ
- ูุฑุงุฑ ุฅููุงุก ุงูุฎุฏูุฉ

ใุชูุตูุงุชใ
ุงุณุชุฑุงุชูุฌูุฉ ุงููุถูุฉ ุงูุนูุงููุฉ`,
        deadlineSpecific: `
- ูุฏุฉ ุฑูุน ุงูุฏุนูู ุงูุนูุงููุฉ (12 ุดูุฑ ูู ุชุงุฑูุฎ ุงูุชูุงุก ุงูุนูุงูุฉ)
- ููุงุนูุฏ ุฌูุณุงุช ุงููุญุงูู ุงูุนูุงููุฉ`,
        systemsToCheck: `
- ูุธุงู ุงูุนูู ุงูุณุนูุฏู
- ูุงุฆุญุฉ ูุธุงู ุงูุนูู
- ูุฑุงุฑุงุช ูุฒุงุฑุฉ ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ`
    }
};

// ุงูุจุฑููุจุช ุงูุงูุชุฑุงุถู ููุฃููุงุน ุบูุฑ ุงููุญุฏุฏุฉ
const DEFAULT_MEMO_PROMPTS = {
    brain: `
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ ุงูุชุญููู ุงูููุถูุนู ุงูุนุงู:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ใููุฎุต ุงููุฐูุฑุฉใ
- ููุถูุน ุงููุฐูุฑุฉ
- ุงูุฃุทุฑุงู
- ุงูุทูุจุงุช

ใุชุญููู ููุฉ ุงูููููใ
- ููุงุท ุงูููุฉ
- ููุงุท ุงูุถุนู
- ุงูุฃุฏูุฉ ุงููุชููุฑุฉ

ใุงูุฃุณุงููุฏ ุงููุธุงููุฉใ
- ุงูููุงุฏ ุงููุณุชุฎุฏูุฉ
- ููุงุฏ ุฅุถุงููุฉ ููุชุฑุญุฉ

ใุงูุชูุตูุงุชใ
ุชุญุณููุงุช ููุชุฑุญุฉ ูููุฐูุฑุฉ`,
    deadlineSpecific: `
- ุงูููุงุนูุฏ ุงููุธุงููุฉ ุงูุนุงูุฉ`,
    systemsToCheck: `
- ูุธุงู ุงููุฑุงูุนุงุช ุงูุดุฑุนูุฉ
- ุงูุฃูุธูุฉ ุฐุงุช ุงูุตูุฉ ุจููุถูุน ุงููุฐูุฑุฉ`
};

// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
// ๐ ุฏูุงู ุงูุชุญููู
// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

/**
 * ุจูุงุก ุงูุจุฑููุจุช ุญุณุจ ููุน ุงููุฐูุฑุฉ ูููุน ุงูุชุญููู
 */
function buildPrompt(memoType: string, engine: AnalysisEngineType, content: string): string {
    const memoPrompts = MEMO_SPECIFIC_PROMPTS[memoType] || DEFAULT_MEMO_PROMPTS;

    let prompt = '';

    switch (engine) {
        case 'gatekeeper':
            prompt = BASE_GATEKEEPER_PROMPT
                .replace('{DEADLINE_SPECIFIC}', memoPrompts.deadlineSpecific)
                .replace('{TEXT}', content);
            break;

        case 'brain':
            prompt = BASE_BRAIN_PROMPT
                .replace('{MEMO_TYPE_SPECIFIC}', memoPrompts.brain)
                .replace('{TEXT}', content);
            break;

        case 'opponent':
            prompt = BASE_OPPONENT_PROMPT.replace('{TEXT}', content);
            break;

        case 'polish':
            prompt = BASE_POLISH_PROMPT.replace('{TEXT}', content);
            break;

        case 'compliance':
            prompt = BASE_COMPLIANCE_PROMPT
                .replace('{SYSTEMS_TO_CHECK}', memoPrompts.systemsToCheck)
                .replace('{TEXT}', content);
            break;
    }

    return prompt;
}

/**
 * ุชุญููู ูุงุญุฏ ุจูุญุฑู ูุญุฏุฏ
 */
export async function runSingleAnalysis(
    memoType: string,
    memoContent: string,
    engine: AnalysisEngineType
): Promise<MemoAnalysisResult> {
    const engineInfo = ANALYSIS_ENGINES[engine];
    const startTime = Date.now();

    if (!hasGeminiApiKey()) {
        return {
            engine,
            engineName: engineInfo.name,
            icon: engineInfo.icon,
            result: 'ูู ูุชู ุชุนููู ููุชุงุญ API. ูุฑุฌู ุฅุฏุฎุงู ุงูููุชุงุญ ูู ุงูุฅุนุฏุงุฏุงุช.',
            success: false
        };
    }

    try {
        const prompt = buildPrompt(memoType, engine, memoContent);

        // ุงุณุชุฎุฏุงู callLegalAI ูุจุงุดุฑุฉ ููุจุฑููุจุชุงุช ุงููุฎุตุตุฉ
        const result = await callLegalAI(prompt);

        return {
            engine,
            engineName: engineInfo.name,
            icon: engineInfo.icon,
            result: result,
            success: true,
            processingTime: Date.now() - startTime
        };
    } catch (error) {
        return {
            engine,
            engineName: engineInfo.name,
            icon: engineInfo.icon,
            result: error instanceof Error ? error.message : 'ุญุฏุซ ุฎุทุฃ ุบูุฑ ูุชููุน',
            success: false,
            processingTime: Date.now() - startTime
        };
    }
}

/**
 * ุชุดุบูู ุงูุชุญููู ุงููุงูู ุจุฌููุน ุงููุญุฑูุงุช
 */
export async function runFullMemoAnalysis(
    memoType: string,
    memoTypeName: string,
    memoContent: string,
    onProgress?: (completed: number, total: number, current: AnalysisEngineType) => void
): Promise<FullMemoAnalysis> {
    const engines: AnalysisEngineType[] = ['gatekeeper', 'brain', 'opponent', 'polish', 'compliance'];
    const analyses: MemoAnalysisResult[] = [];

    for (let i = 0; i < engines.length; i++) {
        const engine = engines[i];

        if (onProgress) {
            onProgress(i, engines.length, engine);
        }

        try {
            const result = await runSingleAnalysis(memoType, memoContent, engine);
            analyses.push(result);
        } catch (error) {
            analyses.push({
                engine,
                engineName: ANALYSIS_ENGINES[engine].name,
                icon: ANALYSIS_ENGINES[engine].icon,
                result: `ุฎุทุฃ: ${error instanceof Error ? error.message : 'ุฎุทุฃ ุบูุฑ ูุนุฑูู'}`,
                success: false
            });
        }
    }

    return {
        memoType,
        memoTypeName,
        analyses,
        timestamp: new Date()
    };
}

/**
 * ุชุดุบูู ุชุญููู ุณุฑูุน (ุงูุญุงุฑุณ ูุงูุนูู ููุท)
 */
export async function runQuickAnalysis(
    memoType: string,
    memoTypeName: string,
    memoContent: string,
    onProgress?: (completed: number, total: number, current: AnalysisEngineType) => void
): Promise<FullMemoAnalysis> {
    const engines: AnalysisEngineType[] = ['gatekeeper', 'brain'];
    const analyses: MemoAnalysisResult[] = [];

    for (let i = 0; i < engines.length; i++) {
        const engine = engines[i];

        if (onProgress) {
            onProgress(i, engines.length, engine);
        }

        try {
            const result = await runSingleAnalysis(memoType, memoContent, engine);
            analyses.push(result);
        } catch (error) {
            analyses.push({
                engine,
                engineName: ANALYSIS_ENGINES[engine].name,
                icon: ANALYSIS_ENGINES[engine].icon,
                result: `ุฎุทุฃ: ${error instanceof Error ? error.message : 'ุฎุทุฃ ุบูุฑ ูุนุฑูู'}`,
                success: false
            });
        }
    }

    return {
        memoType,
        memoTypeName,
        analyses,
        timestamp: new Date()
    };
}

export default {
    runFullMemoAnalysis,
    runQuickAnalysis,
    runSingleAnalysis,
    ANALYSIS_ENGINES
};
